suite: Sealed Server Configuration

templates:
  - sealed-secret-config.yaml

tests:
  - it: should be empty by default
    asserts:
      - hasDocuments:
          count: 0

  - it: should have a sealed secret for config files if specified
    release:
      name: mumble
    set:
      mumble:
        sealedConfig: "example"
    asserts:
      - containsDocument:
          apiVersion: bitnami.com/v1alpha1
          kind: SealedSecret
          name: mumble-config
      - hasDocuments:
          count: 1
      - equal:
          path: spec.encryptedData["mumble-server.ini"]
          value: example
